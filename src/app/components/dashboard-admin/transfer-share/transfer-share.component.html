<div *ngIf="activeView == 'search'">
  <app-search-edit (statusView)="onTransferStockSelected($event)"></app-search-edit>
</div>

<div *ngIf="activeView === 'transfer'">
    <div class="m-4 rounded-md shadow-md bg-white">
        <p class="text-center py-3 rounded-t-md bg-green-400 text-xl font-semibold text-white">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ö‡∏´‡∏∏‡πâ‡∏ô :
            ‡∏≠‡∏≠‡∏Å‡πÉ‡∏ö‡∏´‡∏∏‡πâ‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏ó‡∏ô‡πÉ‡∏ö‡∏´‡∏∏‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ä‡∏≥‡∏£‡∏∏‡∏î/‡∏™‡∏π‡∏ç‡∏´‡∏≤‡∏¢</p>
        <div class="text-center py-4 gap-4">
            <div class="flex justify-center gap-4">
                <p>‡∏ö‡∏±‡∏ï‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà :  {{ customerData.cusiD }}</p>
                <p>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ : {{ customerData.staDesc }} </p>
            </div>
            <p>‡∏ä‡∏∑‡πà‡∏≠ - ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• : {{ customerData.title }}{{ customerData.fname }} {{ customerData.lname }}</p>
        </div>
        <div class="p-4">
            <table class="table-auto w-full border border-gray-300 rounded-lg shadow-sm">
                <thead>
                    <tr class="bg-blue-600 text-white text-sm uppercase tracking-wider">
                        <th class="px-4 py-2 text-center">‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
                        <th class="px-4 py-2 text-left">‡∏™‡∏≤‡∏Ç‡∏≤</th>
                        <th class="px-4 py-2 text-left">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡πÉ‡∏ö‡∏´‡∏∏‡πâ‡∏ô</th>
                        <th class="px-4 py-2 text-left">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡πÉ‡∏ö‡∏´‡∏∏‡πâ‡∏ô‡πÄ‡∏î‡∏¥‡∏°</th>
                        <th class="px-4 py-2 text-left">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏´‡∏∏‡πâ‡∏ô</th>
                        <th class="px-4 py-2 text-right">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏∏‡πâ‡∏ô</th>
                        <th class="px-4 py-2 text-right">‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏´‡∏∏‡πâ‡∏ô</th>
                        <th class="px-4 py-2 text-center">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                        <th class="px-4 py-2 text-center">‡∏ß‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>
                        <th class="px-4 py-2 text-center">‡∏≠‡∏≠‡∏Å‡πÉ‡∏ö‡∏´‡∏∏‡πâ‡∏ô‡πÉ‡∏´‡∏°‡πà</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-200" *ngFor="let item of stkTransList; ">
                    <tr class="hover:bg-gray-50 transition">
                        <td class="px-4 py-2 text-center">{{ item.roWi }}</td>
                        <td class="px-4 py-2">{{ item.brCode }}</td>
                        <td class="px-4 py-2">{{ item.stkNOTE }}</td>
                        <td class="px-4 py-2">{{ item.stkNOTEo }}</td>
                        <td class="px-4 py-2">{{ item.stkNOStart }} - {{ item.stkNOStop }}</td>
                        <td class="px-4 py-2 text-right">{{ item.stkUNiT | number:'1.0-0' }}</td>
                        <td class="px-4 py-2 text-right">{{ item.stkVALUE | number:'1.0-0'}}</td>
                        <td class="px-4 py-2 text-center">{{ item.stDESC }}</td>
                        <td class="px-4 py-2 text-center">{{ formatThaiDateTime(item.datetimeup) || '-' }}</td>
                        <td class="px-4 py-2 text-center">
                            <button class="px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600" 
                                    (click)="onTransferClick(item)">
                                ‡πÇ‡∏≠‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏°‡∏∑‡∏≠
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>


<div *ngIf="activeView == 'transfers'" class="max-w-7xl mx-auto p-4 bg-white shadow-lg rounded-lg">
    <div class="bg-green-500 text-white text-center py-3 rounded-t-lg mb-4">
        <h2 class="text-xl font-semibold">‡πÉ‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÇ‡∏≠‡∏ô‡∏´‡∏∏‡πâ‡∏ô</h2>
    </div>
    <div class="bg-gray-50 p-3 mb-4" *ngIf="selectedcustomer && selectStockTransfer">
        <div class="grid grid-cols-3 gap-2">
            <div>‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏ô : {{ selectedcustomer.cusId || '-' }}</div>
            <div>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡πÉ‡∏ö‡∏´‡∏∏‡πâ‡∏ô : {{ selectStockTransfer.stkNote || '-' }}</div>
            <div>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏´‡∏∏‡πâ‡∏ô : {{ selectStockTransfer.stkStart || '-' }} - {{ selectStockTransfer.stkEnd || '-' }}
        </div>
    </div>
    <div class="grid grid-cols-3 gap-2 mt-1">
        <div>‡∏ä‡∏∑‡πà‡∏≠ - ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• : {{ selectedcustomer.fullName || '-' }}</div>
        <div>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ : {{ selectStockTransfer.stDESC || '-' }}</div>
        <div>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô : {{ selectStockTransfer.unit || 0 }} ‡∏´‡∏∏‡πâ‡∏ô / {{ selectStockTransfer.unitValue || 0 }} ‡∏ö‡∏≤‡∏ó</div>
    </div>

    <div class="border-t border-gray-300 my-4"></div>

        <div class="flex items-center justify-center my-6 space-x-4 text-base font-medium">
        <div class="flex items-center space-x-2">
            <span class="bg-blue-100 text-black px-3 py-1 rounded">‡∏ú‡∏π‡πâ‡πÇ‡∏≠‡∏ô</span>
            <span class="text-gray-400 text-2xl">‚¨ÜÔ∏è-‚¨áÔ∏è</span>
            <span class="bg-blue-100 text-black px-3 py-1 rounded">‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÇ‡∏≠‡∏ô</span>
        </div>
    </div>
    
    <div *ngIf="foundUser" class="border-t border-gray-300 my-4"></div>

    <div class="flex justify-center">
        <form class="space-y-4 w-full">
            <div class="flex items-center space-x-2">
                <label for="" class="font-medium text-gray-700 w-40">‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡∏´‡∏∏‡πâ‡∏ô :</label>
                <select [(ngModel)]="transferForm.reason" 
                id="reason" name="reason" class="flex-1 border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-1 focus:ring-blue-500">
                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•</option>
                <option *ngFor="let rem of remcodeList" [value]="rem.remCode">
                    {{ rem.remDesc }}
                </option>
            </select>
            </div>
                         <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡πà‡∏≠‡∏á‡∏ö‡∏±‡∏ï‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏ô‡∏ï‡∏•‡∏≠‡∏î‡πÄ‡∏ß‡∏•‡∏≤ -->
             <div class="flex items-center space-x-2">
                 <label for="" class="font-medium text-gray-700 w-40">‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏ô :</label>
                 <input type="text" [(ngModel)]="transferForm.idCard" name="idCard" class="flex-1 border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-1 focus:ring-blue-500">
                 <button type="button" 
                         (click)="onAddPerson()"
                         class="bg-green-300 hover:bg-green-400 text-white px-3 py-2 rounded flex items-center justify-center">
                     <span class="text-lg">‚ûï</span>
                 </button>
             </div>
            
            <div *ngIf="foundUser" class="border-t border-gray-300 my-4"></div>
            
                         <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÇ‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏û‡∏ö -->
             <div *ngIf="foundUser" class="bg-gray-50 p-4 mb-4">
                 <div class="flex justify-between items-start w-full">
                     <div class="flex-1 space-y-3">
                         <div class="flex items-center">
                             <span class="font-medium text-gray-700 w-40">‡∏ö‡∏±‡∏ï‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà :</span>
                             <span class="text-gray-900 font-medium">{{ transferForm.idCard || '-' }}</span>
                         </div>
                         <div class="flex items-center">
                             <span class="font-medium text-gray-700 w-40">‡∏ä‡∏∑‡πà‡∏≠ - ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• :</span>
                             <span class="text-gray-900 font-medium">{{ foundUser.fullName || '-' }}</span>
                         </div>
                     </div>  
                     <div class="flex-1 flex justify-end">
                         <div class="flex items-center">
                             <span class="font-medium text-gray-700 mr-3">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏∏‡πâ‡∏ô :</span>
                             <div class="flex items-center space-x-2">
                                 <input type="number" 
                                        [(ngModel)]="transferForm.shareAmount" 
                                        name="shareAmount" 
                                        min="0" 
                                        [max]="getRemainingShares()"
                                        [disabled]="isShareAmountConfirmed"
                                        [class]="isShareAmountConfirmed ? 'border border-gray-300 rounded px-3 py-2 text-center w-24 bg-gray-100 cursor-not-allowed' : 'border border-gray-300 rounded px-3 py-2 text-center w-24 focus:outline-none focus:ring-2 focus:ring-blue-500'">
                                 <button *ngIf="!isShareAmountConfirmed" 
                                         type="button" 
                                         (click)="onConfirmShareAmount()"
                                         class="bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded text-sm font-medium ml-2">
                                     ‚úîÔ∏è </button>
                                 <button *ngIf="isShareAmountConfirmed" 
                                         type="button" 
                                         (click)="onEditShareAmount()"
                                         class="bg-orange-500 hover:bg-orange-600 text-white px-3 py-2 rounded text-sm font-medium ml-2">
                                     ‚úñÔ∏è </button>
                             </div>
                         </div>
                     </div>
                 </div>
             </div>

             

            <!-- ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏õ‡∏±‡∏ô‡∏ú‡∏• - ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏∏‡πâ‡∏ô‡πÅ‡∏•‡πâ‡∏ß -->
            <div *ngIf="isShareAmountConfirmed" class="grid grid-cols-4 gap-6 px-4 mt-2 items-start">
                    <label for="" class="col-span-1 whitespace-nowrap text-gray-700 font-semibold text-right">
                        ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏õ‡∏±‡∏ô‡∏ú‡∏•‡πÄ‡∏õ‡πá‡∏ô :
                    </label>
                    <div class="col-span-3">
                        <div class="flex gap-4 items-start">
                            <!-- Radio -->
                            <input type="radio" name="stkPayType" id="bankAccount" class="mt-2" value="001"
                                [(ngModel)]="transferForm.payType" (change)="onPayTypeChange()">

                            <!-- Form -->
                            <div class="flex flex-col gap-4 w-full">
                                <!-- Grid 2 columns -->
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <!-- Account Type -->
                                    <div class="flex items-center gap-2">
                                        <label for="accountType"
                                            class="whitespace-nowrap text-gray-700">‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÄ‡∏á‡∏¥‡∏ô‡∏ù‡∏≤‡∏Å :</label>                           
                                            <select id="accountType" name="accountType"
                                                 [class]="transferForm.payType === '003' ? 'border border-gray-300 rounded-md p-2 bg-gray-100 font-semibold w-full cursor-not-allowed pointer-events-none opacity-50' : 'border border-gray-300 rounded-md p-2 bg-blue-100 font-semibold w-full'"
                                                 [(ngModel)]="transferForm.accountType" [disabled]="true">
                                                 <option *ngFor="let act of actypeList" [value]="act.accType">
                                                     {{act.accDesc}}</option>
                                             </select>
                                    </div>
                                    <!-- Account Number -->
                                    <div class="flex items-center gap-2">
                                        <label for="accountNumber"
                                            class="whitespace-nowrap text-gray-700">‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà :</label>
                                        <input type="text" id="accountNumber" name="accountNumber"
                                            [(ngModel)]="transferForm.accountNumber"
                                            [class]="transferForm.payType === '003' ? 'w-full border border-gray-300 rounded-md p-2 bg-gray-100 cursor-not-allowed opacity-50' : 'w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500'"
                                            [disabled]="transferForm.payType === '003'">
                                    </div>
                                    </div>
                                    <!-- Account Name -->
                                    <div class="flex items-center gap-2">
                                        <label for="accountName"
                                            class="whitespace-nowrap text-gray-700">‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ :
                                        </label>
                                        <input type="text" id="accountName" name="accountName"
                                            [(ngModel)]="transferForm.accountName"
                                            [class]="transferForm.payType === '003' ? 'w-full border border-gray-300 rounded-md p-2 bg-gray-100 cursor-not-allowed opacity-50' : 'w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500'"
                                            [disabled]="transferForm.payType === '003'">
                                    </div>
                            </div>
                        </div>
                        <div class="flex gap-4 mt-2">
                            <input type="radio" name="stkPayType" value="003" [(ngModel)]="transferForm.payType" (change)="onPayTypeChange()">
                            <label for="">‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ‡πÉ‡∏´‡πâ ‡∏ò.‡∏Å.‡∏™.</label>
                        </div>

                    </div>
                    <button *ngIf="(foundUser || transferRecipients.length > 0) && isShareAmountConfirmed && transferForm.payType" 
                        type="button" 
                        (click)="addRecipient()"
                        class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded flex items-center">
                        ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÇ‡∏≠‡∏ô
                    </button>
                </div>
             
            <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÇ‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß - ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡∏™‡∏∏‡∏î -->
            <div *ngIf="transferRecipients.length > 0" class="bg-blue-50 p-4 mb-4 rounded-lg border-2 border-blue-200">
                <h3 class="text-lg font-semibold text-blue-800 mb-3 flex items-center">
                    <span class="mr-2">üìã</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÇ‡∏≠‡∏ô ({{ transferRecipients.length }} ‡∏Ñ‡∏ô)
                </h3>
                <div class="space-y-3">
                    <div *ngFor="let recipient of transferRecipients; let i = index" 
                        class="bg-white p-3 rounded border border-blue-200 shadow-sm">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <div class="flex items-center mb-2">
                                    <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm font-medium mr-2">
                                        ‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà {{ i + 1 }}
                                    </span>
                                    <span class="text-gray-900 font-medium">{{ recipient.fullName }}</span>
                                </div>
                                <div class="text-sm text-gray-600">
                                    <span>‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£: {{ recipient.idCard }}</span>
                                </div>
                                <div class="text-sm text-gray-600">
                                    <span>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏∏‡πâ‡∏ô: {{ recipient.shareAmount }} ‡∏´‡∏∏‡πâ‡∏ô </span>
                                    <span class="mx-2">|</span>
                                    <span>‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏´‡∏∏‡πâ‡∏ô: {{ selectStockTransfer.unitValue }} ‡∏ö‡∏≤‡∏ó</span>
                                </div>
                                <div class="text-sm text-gray-600 mt-1">
                                    <span>‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô: {{ getReasonText(recipient.reason) }}</span>
                                </div>
                            </div>
                            <div class="flex space-x-2">
                                <button type="button" 
                                        (click)="editRecipient(i)"
                                        class="bg-blue-500 hover:bg-blue-600 text-white px-2 py-1 rounded text-sm transition-colors">
                                    ‚úèÔ∏è
                                </button>
                                <button type="button" 
                                        (click)="removeRecipient(i)"
                                        class="bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded text-sm transition-colors">
                                    üóëÔ∏è
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
             
            <div class="flex justify-center space-x-4 mt-6">
                <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÇ‡∏≠‡∏ô‡∏Ñ‡∏ô‡πÉ‡∏´‡∏°‡πà - ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÇ‡∏≠‡∏ô ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏∏‡πâ‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏õ‡∏±‡∏ô‡∏ú‡∏•‡πÅ‡∏•‡πâ‡∏ß -->

                
                <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å - ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÇ‡∏≠‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô -->
                <button *ngIf="transferRecipients.length > 0" 
                    type="button" 
                    (click)="onSaveTransferRecord()"
                    class="bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded flex items-center">
                    ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                </button>
                
                <button type="button" 
                    (click)="onCancelTransfer()"
                    class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded flex items-center">
                    ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                </button>
            </div>
        </form>
</div>

<!-- Debug: ‡πÅ‡∏™‡∏î‡∏á activeView ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô -->
<div class="fixed top-0 left-0 bg-red-500 text-white p-2 z-50">
  activeView: {{ activeView }}
</div>

<!-- Debug: ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç activeView -->
<div class="fixed top-0 right-0 bg-blue-500 text-white p-2 z-50">
  activeView === 'summary': {{ activeView === 'summary' }}
</div>

<!-- ‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡∏´‡∏∏‡πâ‡∏ô -->
<div *ngIf="activeView === 'summary'" class="max-w-4xl mx-auto p-6">
    <!-- Debug: ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß -->
    <div class="bg-yellow-500 text-black p-2 mb-4 text-center font-bold">
        üéâ ‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏•‡πâ‡∏ß!
      </div>
      <div class="bg-white rounded-lg shadow-lg">
          <!-- ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ -->
          <div class="bg-green-600 text-white p-4 rounded-t-lg">
              <h2 class="text-xl font-semibold text-center">‡πÇ‡∏≠‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏°‡∏∑‡∏≠ : ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</h2>
          </div>
  
          <div class="p-6 space-y-6">
              <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÇ‡∏≠‡∏ô -->
              <div class="bg-blue-50 rounded-lg p-4">
                  <h3 class="text-lg font-semibold text-blue-800 mb-3 flex items-center">
                      <span class="mr-2">üë§</span> ‡∏ú‡∏π‡πâ‡πÇ‡∏≠‡∏ô
                  </h3>
                  <div class="grid grid-cols-2 gap-4 text-sm">
                      <div>
                          <span class="font-medium text-gray-700">‡∏ä‡∏∑‡πà‡∏≠ - ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• :</span>
                          <!-- <span class="ml-2">{{ selectedcustomer?.fullName || '-' }}</span> -->
                      </div>
                      <div>
                          <span class="font-medium text-gray-700">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡πÉ‡∏ö‡∏´‡∏∏‡πâ‡∏ô :</span>
                          <!-- <span class="ml-2">{{ selectStockTransfer?.stkNote || '-' }}</span> -->
                      </div>
                      <div>
                          <span class="font-medium text-gray-700">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏∏‡πâ‡∏ô :</span>
                          <!-- <span class="ml-2">{{ selectStockTransfer?.unit || 0 }} ‡∏´‡∏∏‡πâ‡∏ô</span> -->
                      </div>
                      <div>
                          <span class="font-medium text-gray-700">‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏´‡∏∏‡πâ‡∏ô :</span>
                          <!-- <span class="ml-2">{{ selectStockTransfer?.unitValue | number:'1.0-2' }} ‡∏ö‡∏≤‡∏ó</span> -->
                      </div>
                      <div>
                          <span class="font-medium text-gray-700">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏´‡∏∏‡πâ‡∏ô :</span>
                          <!-- <span class="ml-2">{{ selectStockTransfer?.stkStart || '-' }} - {{ selectStockTransfer?.stkEnd || '-' }}</span> -->
                      </div>
                      <div>
                          <span class="font-medium text-gray-700">‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô :</span>
                          <!-- <span class="ml-2">{{ getReasonText(transferForm.reason) }}</span> -->
                      </div>
                  </div>
              </div>
  
              <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÇ‡∏≠‡∏ô -->
              <!-- <div class="bg-blue-50 rounded-lg p-4">
                  <h3 class="text-lg font-semibold text-blue-800 mb-3 flex items-center">
                      <span class="mr-2">üìã</span> ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÇ‡∏≠‡∏ô ({{ transferRecipients.length }} ‡∏Ñ‡∏ô)
                  </h3>
                  <div class="space-y-4">
                      <div *ngFor="let recipient of transferRecipients; let i = index" 
                           class="bg-white p-4 rounded border border-blue-200">
                          <div class="grid grid-cols-2 gap-4 text-sm">
                              <div>
                                  <span class="font-medium text-gray-700">‡∏ä‡∏∑‡πà‡∏≠ - ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• :</span>
                                  <span class="ml-2">{{ recipient.fullName || '-' }}</span>
                              </div>
                              <div>
                                  <span class="font-medium text-gray-700">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡πÉ‡∏ö‡∏´‡∏∏‡πâ‡∏ô :</span>
                                  <span class="ml-2">#{{ recipient.idCard }}T{{ i.toString().padStart(3, '0') }} (‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß)</span>
                              </div>
                              <div>
                                  <span class="font-medium text-gray-700">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏∏‡πâ‡∏ô :</span>
                                  <span class="ml-2">{{ recipient.shareAmount || 0 }} ‡∏´‡∏∏‡πâ‡∏ô</span>
                              </div>
                              <div>
                                  <span class="font-medium text-gray-700">‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏´‡∏∏‡πâ‡∏ô :</span>
                                  <span class="ml-2">{{ (recipient.shareAmount || 0) * (selectStockTransfer?.unitValue || 0) | number:'1.0-2' }} ‡∏ö‡∏≤‡∏ó</span>
                              </div>
                              <div>
                                  <span class="font-medium text-gray-700">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏´‡∏∏‡πâ‡∏ô :</span>
                                  <span class="ml-2">{{ selectStockTransfer?.stkStart || '-' }} - {{ selectStockTransfer?.stkEnd || '-' }}</span>
                              </div>
                              <div>
                                  <span class="font-medium text-gray-700">‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏õ‡∏±‡∏ô‡∏ú‡∏• :</span>
                                  <span class="ml-2">{{ getPayTypeText(recipient.payType) }}</span>
                              </div>
                          </div>
                      </div>
                  </div>
              </div> -->
  
              <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ -->
              <div class="flex justify-center pt-4">
                  <button type="button" 
                          (click)="goBackToSearch()"
                          class="bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded flex items-center">
                      <span class="mr-2">üè†</span> ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å
                  </button>
              </div>
          </div>
      </div>
</div>

<div *ngIf="loading"
  class="fixed inset-0 z-50 flex items-center justify-center bg-gray-100 bg-opacity-40 backdrop-blur-sm"
  style="background-color: rgba(128, 128, 128, 0.7);">
  <div class="text-center">
    <svg class="animate-spin h-10 w-10 text-blue-600 mx-auto mb-4" xmlns="http://www.w3.org/2000/svg" fill="none"
      viewBox="0 0 24 24">
      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" />
      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z" />
    </svg>
    <p class="text-lg text-white font-medium">üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà...</p>
  </div>
</div>