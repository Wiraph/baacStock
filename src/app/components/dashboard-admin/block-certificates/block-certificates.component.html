<!-- ‡∏´‡∏ô‡πâ‡∏≤‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ -->
<div *ngIf="activeView === 'search'">
  <app-search-edit 
                   (viewStock)="onViewStock($event)"
                   (blockCertificate)="onBlockCertificateSelected($event)">
  </app-search-edit>
</div>

<!-- ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ö‡∏´‡∏∏‡πâ‡∏ô -->
<div *ngIf="activeView === 'certificate-list'" class="p-4">
  <div *ngIf="selectedcustomer" class="w-full bg-white rounded-xl shadow-md">
    <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏•‡∏±‡∏ö -->
    <div class="flex justify-start px-4 py-2">
      <button (click)="goBack()" 
              class="bg-gray-300 text-gray-800 px-4 py-2 rounded hover:bg-gray-400 transition-colors">
        ‚Üê ‡∏Å‡∏•‡∏±‡∏ö
      </button>
    </div>

    <!-- ‡∏´‡∏±‡∏ß‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á -->
    <div class="bg-red-600 rounded-t-xl text-center py-3">
      <p class="text-xl text-white font-bold">üîí ‡∏ö‡∏•‡πá‡∏≠‡∏Ñ/‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏ö‡∏•‡πá‡∏≠‡∏Ñ ‡πÉ‡∏ö‡∏´‡∏∏‡πâ‡∏ô</p>
    </div>

    <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ -->
    <div class="w-full flex flex-col items-center justify-center text-center space-y-2 py-4">
      <div class="flex gap-4">
        <div class="flex items-center gap-2">
          <label class="font-medium">‡∏ö‡∏±‡∏ï‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà:</label>
          <p class="text-gray-700">{{ selectedcustomer.cusId }}</p>
        </div>
        <div class="flex items-center gap-2">
          <label class="font-medium">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</label>
          <p class="text-gray-700">{{ selectedcustomer.status }}</p>
        </div>
      </div>
      <div class="flex items-center gap-2">
        <label class="font-medium">‡∏ä‡∏∑‡πà‡∏≠ - ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•:</label>
        <p class="text-gray-700">{{ selectedcustomer.fullName }}</p>
      </div>
    </div>

    <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ö‡∏´‡∏∏‡πâ‡∏ô -->
    <div class="p-4">
      <table class="table-auto w-full border border-collapse shadow-md">
        <thead class="bg-red-100 text-gray-800">
          <tr>
            <th class="border px-3 py-2 text-center">‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
            <th class="border px-3 py-2 text-center">‡∏™‡∏≤‡∏Ç‡∏≤</th>
            <th class="border px-3 py-2 text-center">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡πÉ‡∏ö‡∏´‡∏∏‡πâ‡∏ô</th>
            <th class="border px-3 py-2 text-center">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡πÉ‡∏ö‡∏´‡∏∏‡πâ‡∏ô‡πÄ‡∏î‡∏¥‡∏°</th>
            <th class="border px-3 py-2 text-center">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏´‡∏∏‡πâ‡∏ô</th>
            <th class="border px-3 py-2 text-center">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏∏‡πâ‡∏ô</th>
            <th class="border px-3 py-2 text-center">‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏´‡∏∏‡πâ‡∏ô</th>
            <th class="border px-3 py-2 text-center">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
            <th class="border px-3 py-2 text-center">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>
            <th class="border px-3 py-2 text-center">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
          </tr>
        </thead>
        <tbody>
          <!-- Debug info -->
          <tr *ngIf="!getFilteredStocks().length" class="bg-yellow-50">
            <td colspan="10" class="border px-3 py-2 text-center text-gray-600">
              ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ö‡∏´‡∏∏‡πâ‡∏ô (Debug: {{ selectedcustomer?.stock?.length || 0 }} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)
            </td>
          </tr>
          
          <tr *ngFor="let stock of getFilteredStocks(); let i = index" 
              class="hover:bg-gray-100 transition-colors">
            <td class="border px-3 py-2 text-center">{{ i + 1 }}</td>
            <td class="border px-3 py-2 text-center">{{ stock.brCode || "-" }}</td>
            <td class="border px-3 py-2 text-center">{{ stock.stkNote }}</td>
            <td class="border px-3 py-2 text-center">{{ stock.stkNoteo || "-" }}</td>
            <td class="border px-3 py-2 text-center">{{ stock.stkNostart || "-" }} - {{ stock.stkNostop || "-" }}</td>
            <td class="border px-3 py-2 text-center">{{ stock.stkUniT || "-" }}</td>
            <td class="border px-3 py-2 text-center">{{ stock.stkValue ? (stock.stkValue | number:'1.0-2') : "-" }}</td>
            <td class="border px-3 py-2 text-center">
              <span [class]="getStatusBadge(stock.stkStatus).class + ' px-2 py-1 rounded-full text-xs'">
                {{ getStatusBadge(stock.stkStatus).text }}
              </span>
            </td>
            <td class="border px-3 py-2 text-center">{{ formatThaiDateTime(stock.stkDateInput) }}</td>
            <td class="border px-3 py-2 text-center">
              <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏ö‡∏•‡πá‡∏≠‡∏Ñ (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÉ‡∏ö‡∏´‡∏∏‡πâ‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥) -->
              <button *ngIf="stock.stkStatus !== 'S008'"
                      (click)="onBlockCertificate(stock.stkNote)"
                      class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 transition-colors mr-1">
                üîí ‡∏ö‡∏•‡πá‡∏≠‡∏Ñ
              </button>
              
              <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏ö‡∏•‡πá‡∏≠‡∏Ñ (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÉ‡∏ö‡∏´‡∏∏‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ö‡∏•‡πá‡∏≠‡∏Ñ) -->
              <button *ngIf="stock.stkStatus === 'S008'"
                      (click)="onUnblockCertificate(stock)"
                      class="bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600 transition-colors">
                üîì ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏ö‡∏•‡πá‡∏≠‡∏Ñ
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>



<!-- Loading Overlay -->
<div *ngIf="loading" 
     class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
  <div class="bg-white rounded-lg p-6 flex items-center space-x-3">
    <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-red-600"></div>
    <span class="text-gray-700">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£...</span>
  </div>
</div> 