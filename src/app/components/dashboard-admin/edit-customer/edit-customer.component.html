<div *ngIf="activeView == 'search'">
    <app-search-edit (statusView)="handleData($event)"></app-search-edit>
</div>
<div *ngIf="activeView == 'edit' && customer">
    <div class="m-4 bg-white rounded-md shadow-md">
        <div class="py-3 bg-green-500 rounded-t-md">
            <p class="text-center text-xl text-white font-semibold">✏️ แก้ไขข้อมูล</p>
        </div>
        <div class="p-4">
            <form (ngSubmit)="onSubmit($event)" [formGroup]="customerForm">
                <mat-tab-group dynamicHeight>
                    <mat-tab label="ข้อมูลผู้ถือหุ้น">
                        <div class="p-2">

                            <!-- ข้อมูลลูกค้า -->
                            <div formGroupName="customer">
                                <div class="grid grid-cols-3 gap-6 px-4">
                                    <div class="flex items-center gap-2">
                                        <label for="custype" class="whitespace-nowrap text-gray-700 font-semibold">
                                            ประเภทลูกค้า :
                                        </label>
                                        <select
                                            class="border border-gray-300 rounded-md p-2 bg-blue-100 w-full cursor-not-allowed pointer-events-none"
                                            formControlName="cusCODE" id="custype">
                                            <option *ngFor="let item of custypeList" [value]="item.cusCode">
                                                {{item.cusCode}} : {{item.cusDesc}}
                                            </option>
                                        </select>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <label for=""
                                            class="whitespace-nowrap text-gray-700 font-semibold">ประเภทผู้ถือหุ้น
                                            :</label>
                                        <p class="text-blue-600 text-xl font-semibold m-0">
                                            ( {{ customerForm.get('customer.cusCODEg')?.value }} ) {{
                                            customerForm.get('customer.cusDESCgABBR')?.value }}
                                        </p>
                                    </div>
                                </div>
                                <div class="grid grid-cols-3 gap-6 px-4 mt-2">
                                    <div class="flex items-center gap-2">
                                        <label for="idCard"
                                            class="whitespace-nowrap text-gray-700 font-semibold">บัตรแสดงตน
                                            :</label>
                                        <select id="idCard" formControlName="docTYPE" name="docType"
                                            class="border border-gray-300 rounded-md p-2 bg-blue-100 w-full cursor-not-allowed pointer-events-none">
                                            <option *ngFor="let title of doctypeList" [value]="title.docType">
                                                {{title.docDesc}}
                                            </option>
                                        </select>
                                    </div>
                                    <div class="flex items-center gap-2">
                                         <label for="idNumber"
                                             class="whitespace-nowrap text-gray-700 font-semibold">เลขที่ : </label>
                                         <input id="idNumber" type="text" formControlName="cusiD" readonly
                                             class="border border-gray-300 rounded-md p-2 bg-blue-100 w-full cursor-not-allowed pointer-events-none" />
                                    </div>
                                    <div class="flex items-center gap-2">
                                         <label for="ref" class="whitespace-nowrap text-gray-700 font-semibold">ref. :
                                         </label>
                                         <input id="ref" type="text" formControlName="brCode" readonly
                                             class="border border-gray-300 rounded-md p-2 bg-blue-100 w-full cursor-not-allowed pointer-events-none" />
                                    </div>
                                </div>
                                <div class="grid grid-cols-3 gap-6 px-4 mt-2">
                                    <div class="flex items-center gap-2">
                                        <label for="" class="whitespace-nowrap text-gray-700 font-semibold">คำนำหน้าชื่อ
                                            : </label>
                                        <select formControlName="titleCode" name="title"
                                            class="border border-gray-300 rounded-md p-2 bg-blue-100 w-full cursor-not-allowed pointer-events-none">
                                            <option *ngFor="let title of titleList" [value]="title?.titleCode">
                                                {{title.titleDesc}}
                                            </option>
                                        </select>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <label for="cusTAXid" class="whitespace-nowrap text-gray-700 font-semibold">
                                             ผู้เสียภาษี :
                                        </label>
                                        <input type="text" readonly
                                             class="border border-gray-300 rounded-md p-2 bg-blue-100 w-full cursor-not-allowed pointer-events-none"
                                             formControlName="cusTAXid">
                                     </div>
                                     <div class="flex items-center gap-2">
                                         <label for="unit" class="whitespace-nowrap text-gray-700 font-semibold">ถือหุ้น
                                             :
                                         </label>
                                         <div class="flex align-bottom gap-4 items-center">
                                             <input
                                                 class="border border-gray-300 rounded-md p-2 bg-blue-100 w-full cursor-not-allowed pointer-events-none"
                                                 type="text" formControlName="unit" readonly> หุ้น
                                         </div>
                                     </div>
                                </div>
                                <div class="grid grid-cols-2 px-4 mt-2 gap-4">
                                    <div class="flex items-center gap-2">
                                        <label for="cusFName" class="whitespace-nowrap text-gray-700 font-semibold">
                                            ชื่อ :
                                        </label>
                                        <input
                                            class="border border-gray-300 rounded-md p-2 bg-blue-100 w-full cursor-not-allowed pointer-events-none"
                                            type="text" formControlName="cusFName">
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <label for="cusLName"
                                            class="whitespace-nowrap text-gray-700 font-semibold">นามสกุล
                                            : </label>
                                        <input
                                            class="border border-gray-300 rounded-md p-2 bg-blue-100 w-full cursor-not-allowed pointer-events-none"
                                            type="text" formControlName="cusLName">
                                    </div>
                                </div>
                            </div>

                            <div class="my-6">
                                <hr>
                            </div>

                            <!-- ข้อมูลที่อยู่ -->
                            <div formGroupName="homeAddress">
                                <p class="text-xl text-center mb-3">ที่อยู่ตามทะเบียนบ้าน</p>
                                <div>
                                    <div class="grid grid-cols-3 gap-6 px-4 mt-2">
                                        <div class="flex items-center gap-2">
                                            <label for="" class="whitespace-nowrap text-gray-700 font-semibold">เลขที่ :
                                            </label>
                                            <input type="text"
                                                class="border border-gray-300 rounded-md p-2 focus:outline-none w-full bg-lime-100"
                                                name="" id="" formControlName="housEno">
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <label for="" class="whitespace-nowrap text-gray-700 font-semibold">ซอย :
                                            </label>
                                            <input type="text"
                                                class="border border-gray-300 rounded-md p-2 focus:outline-none w-full bg-lime-100"
                                                formControlName="troG_SOI">
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <label for="" class="whitespace-nowrap text-gray-700 font-semibold">ถนน :
                                            </label>
                                            <input type="text"
                                                class="border border-gray-300 rounded-md p-2 focus:outline-none w-full bg-lime-100"
                                                formControlName="road">
                                        </div>
                                    </div>
                                    <div class="grid grid-cols-3 gap-6 px-4 mt-2">
                                        <div class="flex items-center gap-2">
                                            <label for="" class="whitespace-nowrap text-gray-700 font-semibold">จังหวัด
                                                :
                                            </label>
                                            <select
                                                class="border border-gray-300 rounded-md p-2 focus:outline-none w-full bg-lime-100"
                                                formControlName="prvCODE" name="homeAddressPrvCode"
                                                (change)="onProvinceChangeHome(homeAddress.prvCODE)">
                                                <option *ngFor="let prv of prvData" [value]="prv.prvCode">
                                                    {{prv.prvName}}
                                                </option>
                                            </select>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <label for=""
                                                class="whitespace-nowrap text-gray-700 font-semibold">เขต/อำเภอ :
                                            </label>
                                            <select
                                                class="border border-gray-300 rounded-md p-2 focus:outline-none w-full bg-lime-100"
                                                formControlName="ampCODE" name="homeAddressAmpCode"
                                                (change)="onAumphorChangeHome(homeAddress.prvCODE, homeAddress.ampCODE)">
                                                <option *ngFor="let amp of ampDataHome" [value]="amp.ampCode">{{
                                                    amp.ampName
                                                    }}
                                                </option>
                                            </select>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <label for=""
                                                class="whitespace-nowrap text-gray-700 font-semibold">แขวง/ตำบล :
                                            </label>
                                            <select
                                                class="border border-gray-300 rounded-md p-2 focus:outline-none w-full bg-lime-100"
                                                name="homeAddressTmbCode" formControlName="tmbCODE">
                                                <option *ngFor="let tmb of tumbonDataHome" [value]="tmb.tmbCode">{{
                                                    tmb.tmbName
                                                    }}
                                                </option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="grid grid-cols-3 gap-6 px-4 mt-2">
                                        <div class="flex items-center gap-2">
                                            <label for=""
                                                class="whitespace-nowrap text-gray-700 font-semibold">รหัสไปรษณีย์
                                                :
                                            </label>
                                            <p class="text-blue-600 text-xl font-semibold m-0">{{ zipCodeHome || '-' }}
                                            </p>
                                        </div>
                                        <div class="flex items-center gap-2 col-span-2">
                                            <label for=""
                                                class="whitespace-nowrap text-gray-700 font-semibold">โทรศัพท์บ้าน
                                                :
                                            </label>
                                            <input type="text"
                                                class="border border-gray-300 rounded-md p-2 focus:outline-none w-full bg-lime-100"
                                                formControlName="phone">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="my-6">
                                <hr>
                            </div>
                            <div formGroupName="currentAddress">
                                <p class="text-xl text-center mb-3">ที่อยู่ที่สามารถติดต่อได้</p>
                                <div class="grid grid-cols-3 gap-6 px-4 mt-2">
                                    <div class="flex items-center gap-2">
                                        <label for="" class="whitespace-nowrap text-gray-700 font-semibold">เลขที่ :
                                        </label>
                                        <input type="text"
                                            class="border border-gray-300 rounded-md p-2 focus:outline-none w-full bg-lime-100"
                                            name="" id="" formControlName="housEno">
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <label for="" class="whitespace-nowrap text-gray-700 font-semibold">ซอย :
                                        </label>
                                        <input type="text"
                                            class="border border-gray-300 rounded-md p-2 focus:outline-none w-full bg-lime-100"
                                            formControlName="troG_SOI">
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <label for="" class="whitespace-nowrap text-gray-700 font-semibold">ถนน :
                                        </label>
                                        <input type="text"
                                            class="border border-gray-300 rounded-md p-2 focus:outline-none w-full bg-lime-100"
                                            formControlName="road">
                                    </div>
                                </div>
                                <div class="grid grid-cols-3 gap-6 px-4 mt-2">
                                    <div class="flex items-center gap-2">
                                        <label for="" class="whitespace-nowrap text-gray-700 font-semibold">จังหวัด :
                                        </label>
                                        <select
                                            class="border border-gray-300 rounded-md p-2 focus:outline-none w-full bg-lime-100"
                                            formControlName="prvCODE" name="currentAddressPrvCode"
                                            (change)="onProvinceChangeCurrent(currentAddress.prvCODE)">
                                            <option *ngFor="let prv of prvData" [value]="prv.prvCode">{{prv.prvName}}
                                            </option>
                                        </select>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <label for="" class="whitespace-nowrap text-gray-700 font-semibold">เขต/อำเภอ :
                                        </label>
                                        <select
                                            class="border border-gray-300 rounded-md p-2 focus:outline-none w-full bg-lime-100"
                                            formControlName="ampCODE" name="currentAddressAmpcode"
                                            (change)="onAumphorChangeCurrent(currentAddress.prvCODE, currentAddress.ampCODE)">
                                            <option *ngFor="let amp of ampDataCurrent" [value]="amp.ampCode">{{
                                                amp.ampName
                                                }}
                                            </option>
                                        </select>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <label for="" class="whitespace-nowrap text-gray-700 font-semibold">แขวง/ตำบล :
                                        </label>
                                        <select
                                            class="border border-gray-300 rounded-md p-2 focus:outline-none w-full bg-lime-100"
                                            name="currentAddressTmbCode" formControlName="tmbCODE">
                                            <option *ngFor="let tmb of tumbonDataCurrent" [value]="tmb.tmbCode">{{
                                                tmb.tmbName
                                                }}
                                            </option>
                                        </select>
                                    </div>
                                </div>
                                <div class="grid grid-cols-3 gap-6 px-4 mt-2">
                                    <div class="col-span-1 flex gap-2 items-center">
                                        <label for="" class="whitespace-nowrap text-gray-700 font-semibold">รหัสไปรษณีย์
                                            :
                                        </label>
                                        <p class="text-blue-600 text-xl font-semibold m-0">{{ zipCodeCurrent || '-' }}
                                        </p>
                                    </div>
                                    <div class="col-span-2 flex items-center gap-2">
                                        <label for=""
                                            class="whitespace-nowrap text-gray-700 font-semibold">โทรศัพท์มือถือ :
                                        </label>
                                        <div class="flex gap-2 items-center w-full">
                                            <input type="text"
                                                class="border border-gray-300 rounded-md p-2 focus:outline-none w-full bg-lime-100"
                                                formControlName="phone">
                                            <p class="whitespace-nowrap">( ตัวเลข 10 หลักเท่านั้น )</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="py-6">
                                    <hr>
                                </div>
                                <div class="grid grid-cols-3 gap-6 px-4 mt-2">
                                    <div>
                                    </div>
                                    <div class="col-span-2 flex items-center gap-2">
                                        <label class="whitespace-nowrap text-gray-700 font-semibold" for="">อีเมล :
                                        </label>
                                        <input type="text"
                                            class="border border-gray-300 rounded-md p-2 focus:outline-none w-full bg-lime-100"
                                            [value]="customer.email || '-'">
                                    </div>
                                </div>
                                <div class="py-6">
                                    <hr>
                                </div>
                                <div>
                                    <p class="text-xl text-center mb-3">ที่อยู่ที่สามารถติดต่อได้จากระบบเดิม</p>
                                </div>
                                    <div class="flex flex-col gap-2">
                                     <div class="flex items-center gap-2">
                                         <label class="whitespace-nowrap text-gray-700 font-semibold" for="">ที่อยู่ 1 :
                                         </label>
                                         <input
                                             class="border border-gray-300 rounded-md p-2 bg-blue-100 w-full cursor-not-allowed pointer-events-none"
                                             type="text" name="" id="" formControlName="addR1" readonly>
                                     </div>
                                     <div class="flex items-center gap-2">
                                         <label class="whitespace-nowrap text-gray-700 font-semibold" for="">ที่อยู่ 2 :
                                         </label>
                                         <input
                                             class="border border-gray-300 rounded-md p-2 bg-blue-100 w-full cursor-not-allowed pointer-events-none"
                                             type="text" formControlName="addR2" readonly>
                                     </div>
                                 </div>
                            </div>
                        </div>
                        <div class="py-6 flex gap-4 justify-center">
                            <button
                                class="inline-flex items-center px-6 py-3 bg-green-500 text-white font-semibold text-sm rounded-lg shadow-lg hover:bg-green-600"
                                type="submit" value="UPD">
                                💾 บันทึก
                            </button>
                            <button
                                (click)="onBack()"
                                class="inline-flex items-center px-6 py-3 bg-gray-500 text-white font-semibold text-sm rounded-lg shadow-lg hover:bg-gray-600">
                                ⬅️ กลับ
                            </button>
                        </div>
                    </mat-tab>
                    <mat-tab label="การรับเงินปันผล">
                        <div class="grid grid-cols-4 gap-6 px-4 mt-2 items-center o">
                            <label class="col-span-1 whitespace-nowrap text-gray-700 font-semibold text-right" for="">
                                ปัจจุบันรับเงินปันผลโดย :
                            </label>
                            <p class="col-span-3">{{ dividendData?.payDESC || '-' }}</p>
                        </div>
                        <div class="grid grid-cols-4 gap-6 px-4 mt-2 items-start" formGroupName="dividend">
                            <label class="col-span-1 whitespace-nowrap text-gray-700 font-semibold text-right" for="">
                                รับเงินปันผลเป็น :
                            </label>
                            <div class="col-span-3">
                                                            <div class="flex gap-4 items-start">
                                <!-- Radio -->
                                <input type="radio" name="dividendStkPayType" id="bankAccount" class="mt-2" value="001"
                                    formControlName="dividendStkPayType" (change)="updateFormControlStates()">

                                <!-- Form -->
                                <div class="flex flex-col gap-4 w-full">
                                    <!-- Grid 2 columns -->
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <!-- Account Type -->
                                        <div class="flex items-center gap-2">
                                            <label for="accountType"
                                                class="whitespace-nowrap font-semibold text-gray-700">
                                                บัญชีเงินฝาก :
                                            </label>
                                            <select id="accountType" name="accountType"
                                                formControlName="stkACCtype"
                                                class="border border-gray-300 rounded-md p-2 focus:outline-none w-full bg-blue-100 pointer-events-none">
                                                <option *ngFor="let act of actypeList" [value]="act.accType">
                                                    {{act.accDesc}}</option>
                                            </select>
                                        </div>
                                        <!-- Account Number -->
                                        <div class="flex items-center gap-2">
                                            <label for="accountNumber"
                                                class="whitespace-nowrap">
                                                บัญชีเลขที่ :
                                            </label>
                                            <input type="text" id="accountNumber" name="accountNumber"
                                                formControlName="stkACCno"
                                                [class]="'w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500 ' + (shouldBeGrayedOutDividend('bankAccount') ? 'bg-gray-100' : 'bg-lime-100')" />
                                        </div>
                                    </div>
                                    <!-- Account Name -->
                                    <div class="flex items-center gap-2">
                                        <label for="accountName" class="whitespace-nowrap">
                                            ชื่อบัญชี :
                                        </label>
                                        <input type="text" id="accountName" name="accountName" formControlName="stkACCname"
                                            [class]="'w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500 ' + (shouldBeGrayedOutDividend('bankAccount') ? 'bg-gray-100' : 'bg-lime-100')" />
                                    </div>
                                </div>
                            </div>
                            <div class="flex gap-4 font-semibold text-gray-700">
                                <input type="radio" name="dividendStkPayType" value="002" formControlName="dividendStkPayType" (change)="updateFormControlStates()">
                                <label for="">เงินสด</label>
                            </div>
                            <div class="flex gap-4 font-semibold text-gray-700">
                                <input type="radio" name="dividendStkPayType" value="003" formControlName="dividendStkPayType" (change)="updateFormControlStates()">
                                <label for="">บริจาคให้ ธ.ก.ส.</label>
                            </div>
                            </div>
                        </div>
                        <div class="py-6 flex gap-4 justify-center">
                            <button
                                class="inline-flex items-center px-6 py-3 bg-green-500 text-white font-semibold text-sm rounded-lg shadow-lg hover:bg-green-600"
                                type="submit" value="UPP">
                                💾 บันทึก
                            </button>
                            <button
                                (click)="onBack()"
                                class="inline-flex items-center px-6 py-3 bg-gray-500 text-white font-semibold text-sm rounded-lg shadow-lg hover:bg-gray-600">
                                ⬅️ กลับ
                            </button>
                        </div>
                    </mat-tab>
                </mat-tab-group>

            </form>
        </div>
    </div>
</div>

<!-- Loading Overlay -->
<div *ngIf="loading" class="fixed inset-0 z-50 flex items-center justify-center bg-gray-900 bg-opacity-50"
    style="background-color: rgba(128, 128, 128, 0.7);">
    <div class="text-center">
        <svg class="animate-spin h-10 w-10 text-blue-300 mx-auto mb-4" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="white" stroke-width="4" />
            <path class="opacity-75" fill="white" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z" />
        </svg>
        <p class="text-white font-semibold">กำลังโหลดข้อมูล กรุณารอสักครู่...</p>
    </div>
</div>